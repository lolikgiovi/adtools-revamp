stages: [deploy]

sync_to_github:
  image: alpine:3.20
  stage: deploy
  only: [main]
  before_script:
    - apk add --no-cache git ca-certificates
  script:
    - git config --global user.name "GitLab CI"
    - git config --global user.email "ci@gitlab.com"
    - test -n "$GITHUB_USERNAME" && test -n "$GITHUB_TOKEN"
    - git config --global credential.helper store
    - printf "https://%s:%s@github.com\n" "$GITHUB_USERNAME" "$GITHUB_TOKEN" > ~/.git-credentials
    - git remote add github https://github.com/lolikgiovi/adtools-revamp.git || git remote set-url github https://github.com/lolikgiovi/adtools-revamp.git
    - git branch -f main "$CI_COMMIT_SHA"
    - git push github main --force