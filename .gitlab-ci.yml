stages:
  - deploy

sync_to_github:
  stage: deploy
  only:
    - main
  image: alpine/git:latest
  script:
    # Identity
    - git config --global user.name "GitLab CI"
    - git config --global user.email "ci@gitlab.com"

    # Prove vars exist (will fail fast if not)
    - test -n "$GITHUB_USERNAME"
    - test -n "$GITHUB_TOKEN"

    # Auth for github.com (no token printed to logs)
    - git config --global credential.helper store
    - printf "https://%s:%s@github.com\n" "$GITHUB_USERNAME" "$GITHUB_TOKEN" > ~/.git-credentials

    # Add remote without embedding the token in the URL
    - git remote add github https://github.com/lolikgiovi/adtools-revamp.git

    # Make sure we're pushing the current pipeline commit as 'main'
    - git branch -f main "$CI_COMMIT_SHA"
    - git push github main --force
