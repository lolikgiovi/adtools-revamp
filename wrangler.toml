name = "adtools"
main = "backend-workers/worker.js"
compatibility_date = "2024-10-01"
workers_dev = true

# Serve built assets from Vite's dist directory
assets = { directory = "./dist", binding = "ASSETS" }

# Environment variables
[vars]
DEV_MODE = "false"
SECRET_SALT = "change-me-in-production"
MAIL_FROM = "otp-adtools@lolik.cloud"
MAIL_SUBJECT_PREFIX = "[AD Tools]"
WHITELIST_ENABLED = "false"
ALLOWED_ORIGINS = "http://localhost:5173,tauri://localhost"
ALLOWED_EMAIL_DOMAINS = "bankmandiri.co.id"
SEND_LIVE_USER_LOG = "true"

# R2 bucket for updater manifests and artifacts
[[r2_buckets]]
binding = "UPDATES"
bucket_name = "adtools-updates"

# Production environment overrides
[env.production]
[env.production.vars]
DEV_MODE = "false"
MAIL_FROM = "otp-adtools@lolik.cloud"
MAIL_SUBJECT_PREFIX = "[AD Tools]"
WHITELIST_ENABLED = "false"
ALLOWED_EMAIL_DOMAINS = "bankmandiri.co.id"

[[kv_namespaces]]
binding = "WHITELIST"
id = "d1b16a8778cb4860bb6c1f63f6f51497"
preview_id = "d1b16a8778cb4860bb6c1f63f6f51497"

# Default settings and session storage
[[kv_namespaces]]
binding = "adtools"
id = "cfe36e546aaa428cbdf468a1b337a87c"
preview_id = "cfe36e546aaa428cbdf468a1b337a87c"


# D1 database binding 
[[d1_databases]]
binding = "DB"
database_name = "adtools"
database_id = "9a9a1466-05be-4b18-af48-6e8902fab81a"
migrations_dir = "backend-workers/migrations"

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

[observability.traces]
enabled = true
head_sampling_rate = 1
persist = true